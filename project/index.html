<!DOCTYPE html>
<html>
  <head>
   
    <title>Chubchub</title>
   

    <script src="https://rawgit.com/aframevr/aframe/master/dist/aframe-master.js"></script>

    <script src="../../dist/aframe-super-shooter-kit.min.js"></script>

    <script src="https://unpkg.com/aframe-randomizer-components@^3.0.1/dist/aframe-randomizer-components.min.js"></script> 

    <script src="//cdn.rawgit.com/donmccurdy/aframe-physics-system/v3.3.0/dist/aframe-physics-system.min.js"></script>


    <script>

      $ = (sel) => document.querySelector(sel)
      $$ = (sel) => document.querySelectorAll(sel)
      on = (elem, type, hand) => elem.addEventListener(type,hand)
     
    </script>

    <script>
       let score = 0;

        AFRAME.registerComponent('click-to-shoot', {
            init: function () {

              document.body.addEventListener('mousedown', () => { 
                this.el.emit('shoot'); 
                 $("#shoot").components.sound.playSound();});

              document.body.addEventListener('triggerdown', () => { 
                this.el.emit('shoot'); 
                $("#shoot").components.sound.playSound();
                });
            
              document.body.addEventListener('trackpaddown', () => { this.el.emit('shoot'); });
            }
          });

        AFRAME.registerComponent('hit-handler', {
            dependencies: ['material'],
            init: function () {
         
              var el = this.el;
              el.addEventListener('hit', () => {
              
                //  el.parentNode.removeChild(el);

                //the new one doesn't have hit-handler
                 el.setAttribute("random-position","min: -4 1 -0.5; max: 4 3.5 -6");
                 
                $("#hitsound").components.sound.playSound();

                 score= score+ 1;
                 $("#score").setAttribute('text','value','Score '+(score))
               
              });

             
            }
          });

       AFRAME.registerComponent('raycaster-autorefresh', {
          init: function () {
             
              var el = this.el;
              this.el.addEventListener('model-loaded', function () {
                  var cursorEl = el.querySelector('[raycaster]');
                  cursorEl.components.raycaster.refreshObjects();
              });
            }
        });
   
    </script>

  </head>

 
  <body>

    <a-scene sound="src: url(sound.mp3); loop:true; autoplay:true; volume:0.1;"> 

     	<a-assets>

     <!--   <img id="s" 
        	src="s.jpg" crossorigin="anonymous">-->

          <a-asset-item id="pc" src="pancake/scene.gltf"></a-asset-item>

          <a-asset-item id="spaceman" 
           src="spaceman_model/scene.gltf"></a-asset-item>

          <a-asset-item id="moon" 
           src="moon/scene.gltf"></a-asset-item>


         
      </a-assets>


   <!-- <a-sky  src="#s" ></a-sky>-->


   
    <!-- ---------------------CONTROLLER------------------------------>

      <a-camera id="camera"  look-controls position="0 1.5 0" ></a-camera>

      <a-entity movement-controls="fly: true" position="0 0 0">

      <a-entity oculus-go-controls shooter click-to-shoot ></a-entity>

      <a-entity tracked-controls="controller: 0; idPrefix: OpenVR"></a-entity>

      <a-entity laser-controls="hand: right"  ></a-entity>

      <a-entity id="bulletTemplate" bullet    scale="0.006 0.006 0.006"  gltf-model="#pc" material="color: orange"  static-body ></a-entity>

    <!-- ---------------------SCORE----------------------------->

      <a-text id="score" position="-0.5 1.5 -3" value="Score: 0"></a-text>


      <!----------------------SCENERY---------------------->

     
     <a-sky  color= "#270d2c"></a-sky>
     <!--<a-sky>
      <a-video id= "sky" src="video.mp4" autoplay loop="true" crossorigin="anonymous"></a-video>
    </a-sky>-->
    
    <!-- <a-video src="video.mp4" autoplay loop="true" width="16" height="9" position="0 0 -20"></a-video>-->

      <a-plane color='#013220'
             static-body  
              geometry="primitive: cylinder; radius: 30; height: 0.001" 
              position="0 0 0" 
              material="shader: flat;"
              shadow="receive:true">
      </a-plane>

      <a-entity rotation ="0 60 0" position="-40 10 -20" scale="8 8 8" id='imp-model' gltf-model="#moon" ></a-entity>



      <a-entity light="type: directional; color: blue; intensity: 0.4;"
              position="31 80 -50" castShadow: true;></a-entity>
       <a-entity light="type: directional; color: blue; intensity: 0.4;"
              position="-8 50 -7" castShadow: true;></a-entity>
      <a-entity light="type: hemisphere; color: white; groundColor: #5424ff; intensity: 0.5"></a-entity>
      <a-entity light="type: point; intensity: 1.6; distance: 5; decay: 2; color: red" 
      position="0.275 2 -6"></a-entity>
      <a-entity light="type: point; intensity: 1.0; distance: 5; decay: 2; color: red" 
      position="-1 2 -3.77"></a-entity>
      <a-entity light="type: point; intensity: 0.8; distance: 5; decay: 2; color: red" 
      position="1 2 -3.77"></a-entity>
        <a-entity light="type: point; intensity: 0.8; distance: 5; decay: 2; color: red" 
      position="4 2 -3.77"></a-entity>
       <a-entity light="type: point; intensity: 0.8; distance: 5; decay: 2; color: red" 
      position="-4 2 -3.77"></a-entity>




      <a-entity id='hitsound'
      sound="src: url(hit.mp3); autoplay: false; loop: false;"></a-entity>
      <a-entity id='shoot'
      sound="src: url(shoot2.mp3); autoplay: false; loop: false;  volume:0.2"></a-entity>
    
    
    <!----------------------SPACEMAN---------------------->


      <a-entity  class="target" target="healthPoints: 1" position="-3 3 -1"  id='imp-model' gltf-model="#spaceman" scale="0.2 0.2 0.2" hit-handler  ></a-entity>

      <a-entity class="target" target="healthPoints: 1"  position="2.5 3 -2"  id='imp-model' gltf-model="#spaceman" scale="0.2 0.2 0.2" hit-handler  ></a-entity>

      <a-entity class="target" target="healthPoints: 1"  position="5 3 -4"  id='imp-model' gltf-model="#spaceman" scale="0.2 0.2 0.2" hit-handler ></a-entity>

      <a-entity class="target" target="healthPoints: 1"  position="1 3 -3"  id='imp-model' gltf-model="#spaceman" scale="0.2 0.2 0.2" hit-handler  ></a-entity>

      <a-entity class="target" target="healthPoints: 1"  position="0 3 -4"  id='imp-model' gltf-model="#spaceman" scale="0.2 0.2 0.2" hit-handler  ></a-entity>

       
    <!--   <a-mixin id="sm" class="target" target="healthPoints: 1" id='imp-model' gltf-model="#spaceman" scale="0.2 0.2 0.2" hit-handler  material random-position="min: -100 -100 -100; max: 100 100 100"></a-mixin>
      <a-entity entity-generator="mixin: sm; num: 100"></a-entity>-->


    <!--------------------- PANCAKES---------------------->
        

    	<a-entity  position="0 5 -5" dynamic-body scale="0.01 0.01 0.01" id='imp-model' gltf-model="#pc"></a-entity>

      <a-entity  position="-0.5 5 -3" dynamic-body scale="0.01 0.01 0.01" id='imp-model' gltf-model="#pc"></a-entity>
     
      <a-entity position="-0.5 5 -2" dynamic-body scale="0.01 0.01 0.01" id='imp-model' gltf-model="#pc"></a-entity>
 
      <a-entity  position="2 0 -5" scale="0.01 0.01 0.01" id='imp-model' gltf-model="#pc"> 
      </a-entity>
    
      <a-entity position="2.5 0 -2" scale="0.01 0.01 0.01" id='imp-model' gltf-model="#pc">
      </a-entity>
      
      <a-entity position="3 0 -0.9" scale="0.01 0.01 0.01" id='imp-model' gltf-model="#pc">
      </a-entity>
    

     </a-scene>



  </body>

</html>